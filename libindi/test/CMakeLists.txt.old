CMAKE_MINIMUM_REQUIRED (VERSION 2.8)
PROJECT(libindi_core_test C CXX)

ADD_SUBDIRECTORY(googletest)

ENABLE_TESTING ()

INCLUDE_DIRECTORIES ( . ${GTEST_INCLUDE_DIRS} )

LIST (APPEND check_PROGRAMS
    "drivers/dome/test_baader_dome.cpp"
)

MESSAGE (STATUS "GTEST_BOTH_LIBRARIES = ${GTEST_BOTH_LIBRARIES}")

FOREACH (source_file ${check_PROGRAMS})
    GET_FILENAME_COMPONENT (source_file_we ${source_file} NAME_WE)
    ADD_EXECUTABLE (${source_file_we} ${source_file} )
    TARGET_LINK_LIBRARIES (${source_file_we}
        indi indiclient indidriver
        gmock
        ${GTEST_BOTH_LIBRARIES}
        ${CMAKE_THREAD_LIBS_INIT}
        ${LIBUSB_1_LIBRARIES} ${NOVA_LIBRARIES} ${CMAKE_THREAD_LIBS_INIT} ${CFITSIO_LIBRARIES} ${M_LIB} ${ZLIB_LIBRARY} ${JPEG_LIBRARY}
    )
    #SET_TARGET_PROPERTIES(${source_file_we} PROPERTIES COMPILE_FLAGS "-Wall -Wextra -Wno-unused-variable -g -O3") 
    ADD_TEST (${source_file_we} ${source_file_we})
    SET_PROPERTY (TARGET ${source_file_we} APPEND_STRING PROPERTY COMPILE_FLAGS "-fPIC -Wall -Wextra -Wno-unused-variable -g -O3")   
ENDFOREACH ()


